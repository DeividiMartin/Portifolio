(()=>{var q=Object.defineProperty,P=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var g=(o,c,a)=>c in o?q(o,c,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[c]=a,u=(o,c)=>{for(var a in c||(c={}))N.call(c,a)&&g(o,a,c[a]);if(b)for(var a of b(c))T.call(c,a)&&g(o,a,c[a]);return o},l=(o,c)=>P(o,E(c));(function(){var h;let o=document.currentScript,c="dub_id",a="dub_partner_data",O=90*24*60*60*1e3,d=window.location.hostname,y=o.getAttribute("data-api-host")||"https://api.dub.co",I=o.getAttribute("data-publishable-key"),S=(()=>{let r={domain:d==="localhost"?void 0:`.${d.replace(/^www\./,"")}`,path:"/",sameSite:"Lax",expires:new Date(Date.now()+O).toUTCString()},t=o.getAttribute("data-cookie-options");if(!t)return r;let e=JSON.parse(t);return e.expiresInDays&&(e.expires=new Date(Date.now()+e.expiresInDays*24*60*60*1e3).toUTCString(),delete e.expiresInDays),u(u({},r),e)})(),A=(()=>{let r=o.getAttribute("data-short-domain"),t=o.getAttribute("data-domains");if(t)try{let e=JSON.parse(t);return l(u({},e),{refer:e.refer||r})}catch(e){}return{refer:r}})(),p=A.refer,D=o.getAttribute("data-attribution-model")||"last-click",C=(()=>{let r=o.getAttribute("data-query-param"),t=o.getAttribute("data-query-params"),e=["via"];if(r)e=[r,...e];else if(t)try{e=[...JSON.parse(t),...e]}catch(i){console.warn("[dubAnalytics] Failed to parse data-query-params.",i)}return[...new Set(e)]})(),f=(()=>{let r=new URLSearchParams(location.search);for(let t of C)if(r.get(t))return r.get(t);return null})();if(window.DubAnalytics=window.DubAnalytics||{partner:null,discount:null},window.dubAnalytics){let e=function(i,...n){i==="ready"?e.ready(...n):i==="trackClick"?e.trackClick(...n):console.warn("[dubAnalytics] Unknown method:",i)};var $=e;let t=window.dubAnalytics.q||[];e.q=t,e.ready=function(i){i()},e.trackClick=function(...i){m(...i)},window.dubAnalytics=e}let s={get(r){var t;return(t=document.cookie.split(";").map(e=>e.trim().split("=")).find(([e])=>e===r))==null?void 0:t[1]},set(r,t){let e=Object.entries(S).filter(([,i])=>i).map(([i,n])=>`${i}=${n}`).join("; ");document.cookie=`${r}=${t}; ${e}`}},k={queue:((h=window.dubAnalytics)==null?void 0:h.q)||[],flush(r){let t=[];for(;this.queue.length;){let[e,...i]=this.queue.shift();!r||r(e)?this.process({method:e,args:i}):t.push([e,...i])}this.queue=t},process({method:r,args:t}){if(r==="ready"){let e=t[0];e()}else["trackClick"].includes(r)?m(...t):console.warn("[dubAnalytics] Unknown method:",r)}},w=!1;function m({domain:r,key:t}){if(w)return;w=!0;let i=new URLSearchParams(location.search).get(c);fetch(`${y}/track/click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:r,key:t,url:window.location.href,referrer:document.referrer})}).then(n=>n.ok&&n.json()).then(n=>{if(n){if(i&&i!==n.clickId){console.warn(`[dubAnalytics] Client-tracked click ID ${n.clickId} does not match server-tracked click ID ${i}, skipping...`);return}if(s.set(c,n.clickId),n.partner){let R=l(u({},n),{partner:l(u({},n.partner),{name:encodeURIComponent(n.partner.name),image:n.partner.image?encodeURIComponent(n.partner.image):null})});s.set(a,JSON.stringify(R)),DubAnalytics.partner=n.partner,DubAnalytics.discount=n.discount,k.flush(U=>U==="ready")}return n}})}function _(){let r=new URLSearchParams(location.search),t=()=>!s.get(c)||D!=="first-click",e=r.get(c);e&&t()&&s.set(c,e),f&&p&&t()&&m({domain:p,key:f}),k.flush(n=>n==="trackClick");let i=s.get(a);if(i)try{let n=JSON.parse(i);DubAnalytics.partner=n.partner,DubAnalytics.discount=n.discount}catch(n){console.error("[dubAnalytics] Failed to parse partner cookie:",n)}}window._dubAnalytics={c:s,qm:k,i:c,h:d,a:y,d:p,v:f,n:A,k:I},_()})();})();
