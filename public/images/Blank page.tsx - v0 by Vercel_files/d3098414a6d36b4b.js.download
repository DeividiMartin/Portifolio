(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,837062,e=>{"use strict";var t=e.i(418625),r=e.i(32170),n=e.i(658449);function i(){let{expectUser:e}=(0,r.useUser)(),{data:i,mutate:a}=(0,t.default)("scopes",async()=>{if(!e)return;let t=await fetch("/chat/api/scopes");return await t.json()},{dedupingInterval:6e4});return{scopes:i,isScopesReady:!!i,refreshScopes:(0,n.useCallback)(()=>{a(void 0,!0)},[a])}}e.s(["useScopes",()=>i])},873013,e=>{"use strict";var t=e.i(658449);let r=[[/\/chat\/([a-zA-Z0-9-_]+)/,["id"]]];function n(){let e=window.location.pathname,t={};for(let[n,i]of r){let r=e.match(n);if(r){for(let e=0;e<i.length;e++)t[i[e]]=r[e+1];break}}return t}let i=(0,t.cache)(()=>({}));function a(e,t){i()[e]=t}function o(e){delete i()[e]}e.s(["removeRewrittenParam",()=>o,"setRewrittenParam",()=>a,"useRewrittenParams",()=>n])},906261,e=>{"use strict";function t(e){return!!e&&!("membership"in e)}e.s(["isUserScope",()=>t])},222384,e=>{"use strict";function t({membership:e}){return!!e&&!!(e.entitlements&&e.entitlements.find(e=>"v0"===e.entitlement))}e.s(["teamMemberHasV0Access",()=>t])},691175,e=>{"use strict";function t(e){return!!e&&"limited"in e&&!0===e.limited}function r(e){return!!e&&"limitedBy"in e&&e.limitedBy?.length===1&&e.limitedBy.includes("mfa")}function n({slug:e,push:t}){t(o({slug:e}).toString())}function i({slug:e,push:t}){t(a({slug:e}).toString())}function a({slug:e,path:t}){let r=new URLSearchParams({...t?{next:t}:{},teamSlug:e,twoFactorRequired:"1"});return`/api/auth/login?${r.toString()}`}function o({slug:e,path:t}){let r=new URLSearchParams({...t?{next:t}:{},teamSlug:e});return`/api/auth/login?${r.toString()}`}function l({chatId:e,projectId:t,scopeSlug:r,lastUserInput:n}){let i=(e,t)=>{let r=new URLSearchParams;for(let[e,n]of Object.entries(t))n&&r.set(e,n);return 0===r.size?e:`${e}?${r.toString()}`};return e?i(`/chat/${e}`,{scope:r}):t?i(`/project/${t}`,{scope:r}):n?i("/chat",{q:n,scope:r,pid:t}):void 0}e.s(["generatePathFromContext",()=>l,"getLoginUrlToMissingScopeClient",()=>o,"getTwoFactorRequiredUrlClient",()=>a,"isAuthenticationRequired",()=>t,"isScopeLimitedOnlyByMfa",()=>r,"redirectToLoginToMissingScope",()=>n,"redirectToTwoFactorRequired",()=>i])},37737,e=>{"use strict";var t=e.i(9654),r=e.i(142219),n=e.i(753533);let i=(0,n.cacheResult)(null,()=>({dialogOpen:(0,t.atom)(null),visibleDialogType:(0,t.atom)(null),visibilityTimeout:(0,t.atom)(null)})),a=(0,n.cacheResult)(null,()=>({...i()}));e.s(["closeDialog",0,()=>{let e=i(),t=r.store.get(e.visibilityTimeout);t&&clearTimeout(t),r.store.set(e.visibleDialogType,null),r.store.set(e.visibilityTimeout,setTimeout(()=>{r.store.set(e.dialogOpen,null)},300))},"getDialogsAtoms",0,a,"openDialog",0,e=>{let t=i(),n=r.store.get(t.visibilityTimeout);n&&(clearTimeout(n),r.store.set(t.visibilityTimeout,null)),r.store.set(t.dialogOpen,e),r.store.set(t.visibleDialogType,e.type)}])},532733,e=>{"use strict";let t=(e.i(658449).default.cache||(e=>e))(function(e,t){return e.membership?.entitlements&&e.membership.entitlements.some(e=>"v0"===e.entitlement)||function({user:e,team:t}){var r;return"vercel"===t.slug&&!!(r=e)&&(r.teams.includes("vercel")||r.email?.endsWith("@zeit.pub"))}({user:t,team:e})});e.s(["teamMemberHasV0Entitlement",0,t],532733)},667660,929910,92304,e=>{"use strict";var t=e.i(418625),r=e.i(32170),n=e.i(658449),i=e.i(837062),a=e.i(873013),o=e.i(906261),l=e.i(947936),s=e.i(222384);e.i(563948);var c=e.i(407562),u=e.i(696871),d=e.i(691175),p=e.i(37737),m=e.i(679731),f=e.i(532733),g=e.i(783069),b=e.i(657736);function h(e){return(0,g.toSorted)(e,(e,t)=>e.name?.localeCompare(t.name??"")??0)}function z(e){return(0,g.toSorted)(e,(e,t)=>{let r=(0,d.isAuthenticationRequired)(e),n=(0,o.isUserScope)(e)?"OWNER":e.membership.role,i=(0,d.isAuthenticationRequired)(t),a=(0,o.isUserScope)(t)?"OWNER":t.membership.role;return(r||"OWNER"===n?-1:0)-(i||"OWNER"===a?-1:0)})}function y({children:e}){return(0,m.jsx)(b.motion.div,{exit:{opacity:0,transition:{duration:.1}},initial:{opacity:0,filter:"blur(1px)",scale:.9},animate:{opacity:1,scale:1,filter:"blur(0px)"},className:"text-v0-gray-900",transition:{duration:.3},children:e})}function S(e,t){return(0,o.isUserScope)(e)||t&&(0,f.teamMemberHasV0Entitlement)(e,t)}e.s(["PresenceIcon",()=>y,"doesUserHaveV0Seat",()=>S,"sortScopesByAccess",()=>z,"sortScopesByName",()=>h],929910);var v=e.i(908431);let E=v.z.enum(["speed","quality","vision"]),w=v.z.enum(["paid","grace_period","blocked","cancel","processing"]),C=v.z.enum(["hobby","pro","enterprise"]),A=v.z.enum(["on-demand-credits","high-quality","stealth","gallery","file-upload","qp-h","premium-themes","custom-subdomain","projects","premium-override"]),R=v.z.discriminatedUnion("type",[v.z.object({type:v.z.literal("feature"),name:A,config:v.z.object({level:v.z.literal("limited").optional(),packages:v.z.array(v.z.object({costCents:v.z.number(),creditsAmount:v.z.number()})).optional()}).optional()}),v.z.object({type:v.z.literal("included_credits"),amount:v.z.number()}),v.z.object({type:v.z.literal("credits_cost_basis"),cents:v.z.number()}),v.z.object({type:v.z.literal("messages"),amount:v.z.number()})]),U=v.z.object({kind:v.z.literal("payment-failed"),reason:v.z.string(),paymentMethodId:v.z.string(),at:v.z.number(),invoiceUrl:v.z.string().optional()}),O=v.z.object({productKey:v.z.string(),name:v.z.string(),price:v.z.object({type:v.z.literal("unit"),cents:v.z.number()})}),I=v.z.enum(["v0-level0","v0-level3","v0-team","v0-enterprise","v0-platinum"]),j=v.z.object({slug:I,name:v.z.string(),selfServe:v.z.boolean(),defaultEntitlements:v.z.array(R),items:v.z.array(O)}),T=v.z.object({notices:v.z.array(U),plan:j,items:v.z.array(O),startDate:v.z.string(),endDate:v.z.string().nullable(),upcomingPlanChange:v.z.object({start:v.z.string(),plan:v.z.object({name:v.z.string()})}).nullable(),remainingBalance:v.z.string().nullable(),processingPayment:v.z.string().nullable(),realPlan:j.optional()}),D=T.extend({status:v.z.literal("active"),currentPlanStartDate:v.z.string().optional(),currentBillingPeriod:v.z.object({start:v.z.string(),end:v.z.string()})}),$=T.extend({status:v.z.literal("upcoming"),currentBillingPeriod:v.z.null(),endDate:v.z.string()}),P=T.extend({status:v.z.literal("ended"),currentBillingPeriod:v.z.null(),endDate:v.z.string()}),k=v.z.discriminatedUnion("status",[D,$,P]),V=v.z.object({last4:v.z.string(),brand:v.z.string(),exp:v.z.object({month:v.z.number().optional(),year:v.z.number().optional()}).optional(),email:v.z.string().optional()}).extend({id:v.z.string(),type:v.z.literal("card")});v.z.object({stripeCustomerId:v.z.string(),subscription:k.optional(),settings:v.z.object({mode:v.z.union([v.z.literal("test"),v.z.literal("live")])}),ownerId:v.z.string(),entitlements:v.z.array(R),paymentMethod:V.optional()}),v.z.object({plan:v.z.nullable(C),stripeCustomerId:v.z.string(),awsMarketplace:v.z.object({v0:v.z.object({customerId:v.z.string(),productCode:v.z.string()}).optional(),vercel:v.z.object({customerId:v.z.string(),productCode:v.z.string()}).optional()}).optional(),plans:v.z.array(v.z.object({slug:v.z.string(),status:v.z.union([v.z.literal("active"),v.z.literal("ended")]),billingPeriodStartDate:v.z.number().optional(),billingPeriodEndDate:v.z.number().optional(),subscriptionEndDate:v.z.number().optional(),remainingBalance:v.z.number().optional()})),products:v.z.array(v.z.object({slug:v.z.string(),prices:v.z.array(v.z.object({type:v.z.string(),billableItemSlug:v.z.string(),quantity:v.z.number()}))})),payment:v.z.object({status:v.z.union([v.z.literal("paid"),v.z.literal("pending"),v.z.literal("processing"),v.z.literal("past_due")]),openInvoices:v.z.array(v.z.object({url:v.z.string(),dueAt:v.z.number()}))}).optional()}),v.z.object({slug:v.z.string(),status:v.z.union([v.z.literal("active"),v.z.literal("ended")]),billingPeriodStartDate:v.z.number().optional(),billingPeriodEndDate:v.z.number().optional(),subscriptionEndDate:v.z.number().optional(),remainingBalance:v.z.number().optional()});let L=["V0Builder","V0Chatter","V0Viewer"],N=["V0Builder","V0Chatter"],B=v.z.enum(["OWNER","MEMBER","DEVELOPER","BILLING","VIEWER","CONTRIBUTOR"]);v.z.object({vercelToken:v.z.string(),created:v.z.number().int().positive().optional(),v0plan:v.z.string().nullish(),features:v.z.array(A).optional(),quality:E.optional(),user:v.z.object({id:v.z.string(),username:v.z.string(),email:v.z.string(),avatar:v.z.string(),avatarSha:v.z.string().nullish().transform(e=>null===e?void 0:e),createdAt:v.z.string().optional(),name:v.z.string().nullish().transform(e=>null===e?void 0:e),defaultTeamId:v.z.string().nullish(),plan:v.z.union([C,v.z.literal("anon")]),scope:v.z.string().optional(),v0plan:I.nullish(),realv0Plan:I.nullish(),billingCycleStart:v.z.number().optional(),billingCycleEnd:v.z.number().optional(),paymentStatus:w.optional(),scopeVercelPlan:C.optional(),teamRole:B.nullish(),teamV0Role:v.z.enum(L).nullish(),teamId:v.z.string().nullish(),teamName:v.z.string().optional(),teams:v.z.array(v.z.string()),v:v.z.number().optional(),title:v.z.string().optional(),x:v.z.string().optional(),github:v.z.string().optional(),website:v.z.string().optional(),description:v.z.string().optional(),verified:v.z.boolean().optional(),isAmbassador:v.z.boolean().optional(),location:v.z.string().optional(),isPrivate:v.z.boolean().optional(),limited:v.z.boolean().optional(),billingMode:v.z.literal("test").optional(),stripeCustomerId:v.z.string().nullish().transform(e=>null===e?void 0:e),acceptedTosAt:v.z.number().optional()}),team:v.z.object({billingCycleStart:v.z.number().optional(),billingCycleEnd:v.z.number().optional(),isTokenBasedEnt:v.z.literal(!0).optional()}).optional(),impersonation:v.z.boolean().optional(),actor:v.z.string().optional()});var x=e.i(99474),M=e.i(999817),_=e.i(841953),F=e.i(964652),q=e.i(15916),H=e.i(387575),W=e.i(775962),J=e.i(199352),K=e.i(731487),G=e.i(845027),Q=e.i(860913),Y=e.i(936413),Z=e.i(179918),X=e.i(984379),ee=e.i(62554),et=e.i(385956),er=e.i(495812),en=e.i(812053),ei=e.i(234132),ea=e.i(663917);let eo=n.default.use||(e=>{switch(e.status){case"pending":throw e;case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}}),el={dedupe:!0};M.OBJECT.defineProperty(_.SWRConfig,"defaultValue",{value:F.defaultConfig});let es=(0,q.withArgs)((e,t,r)=>{let{cache:i,compare:a,suspense:o,fallbackData:l,revalidateOnMount:s,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:d,refreshWhenOffline:p,keepPreviousData:m}=r,[f,g,b,h]=H.SWRGlobalState.get(i),[z,y]=(0,W.serialize)(e),S=(0,n.useRef)(!1),v=(0,n.useRef)(!1),E=(0,n.useRef)(z),w=(0,n.useRef)(t),C=(0,n.useRef)(r),A=()=>C.current.isVisible()&&C.current.isOnline(),[R,U,O,I]=(0,J.createCacheHelper)(i,z),j=(0,n.useRef)({}).current,T=(0,K.isUndefined)(l)?(0,K.isUndefined)(r.fallback)?G.UNDEFINED:r.fallback[z]:l;T&&(0,Q.isPromiseLike)(T)&&(T=eo(T));let D=(e,t)=>{for(let r in j)if("data"===r){if(!a(e[r],t[r])&&(!(0,K.isUndefined)(e[r])||!a(_,t[r])))return!1}else if(t[r]!==e[r])return!1;return!0},$=(0,n.useMemo)(()=>{let e=!!z&&!!t&&((0,K.isUndefined)(s)?!C.current.isPaused()&&!o&&!1!==c:s),r=t=>{let r=(0,ea.mergeObjects)(t);return(delete r._k,e)?{isValidating:!0,isLoading:!0,...r}:r},n=R(),i=I(),a=r(n),l=n===i?a:r(i),u=a;return[()=>{let e=r(R());return D(e,u)?(u.data=e.data,u.isLoading=e.isLoading,u.isValidating=e.isValidating,u.error=e.error,u):(u=e,e)},()=>l]},[i,z]),P=(0,x.useSyncExternalStore)((0,n.useCallback)(e=>O(z,(t,r)=>{D(r,t)||e()}),[i,z]),$[0],$[1]),k=!S.current,V=f[z]&&f[z].length>0,L=P.data,N=(0,K.isUndefined)(L)?T:L,B=P.error,M=(0,n.useRef)(N),_=m?(0,K.isUndefined)(L)?M.current:L:N,F=(!V||!!(0,K.isUndefined)(B))&&(k&&!(0,K.isUndefined)(s)?s:!C.current.isPaused()&&(o?!(0,K.isUndefined)(N)&&c:(0,K.isUndefined)(N)||c)),es=!!(z&&t&&k&&F),ec=(0,K.isUndefined)(P.isValidating)?es:P.isValidating,eu=(0,K.isUndefined)(P.isLoading)?es:P.isLoading,ed=(0,n.useCallback)(async e=>{let t,n,i=w.current;if(!z||!i||v.current||C.current.isPaused())return!1;let o=!0,l=e||{},s=!b[z]||!l.dedupe,c=()=>ei.IS_REACT_LEGACY?!v.current&&z===E.current&&S.current:z===E.current,u={isValidating:!1,isLoading:!1},d=()=>{U(u)},p=()=>{let e=b[z];e&&e[1]===n&&delete b[z]},m={isValidating:!0};(0,K.isUndefined)(R().data)&&(m.isLoading=!0);try{if(s&&(U(m),r.loadingTimeout&&(0,K.isUndefined)(R().data)&&setTimeout(()=>{o&&c()&&C.current.onLoadingSlow(z,r)},r.loadingTimeout),b[z]=[i(y),(0,Y.getTimestamp)()]),[t,n]=b[z],t=await t,s&&setTimeout(p,r.dedupingInterval),!b[z]||b[z][1]!==n)return s&&c()&&C.current.onDiscarded(z),!1;u.error=G.UNDEFINED;let e=g[z];if(!(0,K.isUndefined)(e)&&(n<=e[0]||n<=e[1]||0===e[1]))return d(),s&&c()&&C.current.onDiscarded(z),!1;let l=R().data;u.data=a(l,t)?l:t,s&&c()&&C.current.onSuccess(t,z,r)}catch(r){p();let e=C.current,{shouldRetryOnError:t}=e;!e.isPaused()&&(u.error=r,s&&c()&&(e.onError(r,z,e),(!0===t||(0,Z.isFunction)(t)&&t(r))&&(!C.current.revalidateOnFocus||!C.current.revalidateOnReconnect||A())&&e.onErrorRetry(r,z,e,e=>{let t=f[z];t&&t[0]&&t[0](X.revalidateEvents.ERROR_REVALIDATE_EVENT,e)},{retryCount:(l.retryCount||0)+1,dedupe:!0})))}return o=!1,d(),!0},[z,i]),ep=(0,n.useCallback)((...e)=>(0,ee.internalMutate)(i,E.current,...e),[]);if((0,et.useIsomorphicLayoutEffect)(()=>{w.current=t,C.current=r,(0,K.isUndefined)(L)||(M.current=L)}),(0,et.useIsomorphicLayoutEffect)(()=>{if(!z)return;let e=ed.bind(G.UNDEFINED,el),t=0,r=(0,q.subscribeCallback)(z,f,(r,n={})=>{if(r==X.revalidateEvents.FOCUS_EVENT){let r=Date.now();C.current.revalidateOnFocus&&r>t&&A()&&(t=r+C.current.focusThrottleInterval,e())}else if(r==X.revalidateEvents.RECONNECT_EVENT)C.current.revalidateOnReconnect&&A()&&e();else if(r==X.revalidateEvents.MUTATE_EVENT)return ed();else if(r==X.revalidateEvents.ERROR_REVALIDATE_EVENT)return ed(n)});return v.current=!1,E.current=z,S.current=!0,U({_k:y}),F&&((0,K.isUndefined)(N)||er.IS_SERVER?e():(0,en.rAF)(e)),()=>{v.current=!0,r()}},[z]),(0,et.useIsomorphicLayoutEffect)(()=>{let e;function t(){let t=(0,Z.isFunction)(u)?u(R().data):u;t&&-1!==e&&(e=setTimeout(r,t))}function r(){!R().error&&(d||C.current.isVisible())&&(p||C.current.isOnline())?ed(el).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[u,d,p,z]),(0,n.useDebugValue)(_),o&&(0,K.isUndefined)(N)&&z){if(!ei.IS_REACT_LEGACY&&er.IS_SERVER)throw Error("Fallback data is required when using Suspense in SSR.");w.current=t,C.current=r,v.current=!1;let e=h[z];if((0,K.isUndefined)(e)||eo(ep(e)),(0,K.isUndefined)(B)){let e=ed(el);(0,K.isUndefined)(_)||(e.status="fulfilled",e.value=!0),eo(e)}else throw B}return{mutate:ep,get data(){return j.data=!0,_},get error(){return j.error=!0,B},get isValidating(){return j.isValidating=!0,ec},get isLoading(){return j.isLoading=!0,eu}}}),ec=(0,q.withMiddleware)(es,e=>(t,r,n)=>(n.revalidateOnFocus=!1,n.revalidateIfStale=!1,n.revalidateOnReconnect=!1,e(t,r,n)));e.s(["default",()=>ec],92304);class eu extends Error{constructor(e,t){super(e),this.name="DevalueError",this.path=t.join("")}}function ed(e){return Object(e)!==e}let ep=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function em(e){let t="",r=0,n=e.length;for(let i=0;i<n;i+=1){let n=function(e){switch(e){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case"\n":return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e<" "?`\\u${e.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}(e[i]);n&&(t+=e.slice(r,i)+n,r=i+1)}return`"${0===r?e:t+e.slice(r)}"`}let ef=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function eg(e){return ef.test(e)?"."+e:"["+JSON.stringify(e)+"]"}function eb(e){let t=new DataView(e),r="";for(let n=0;n<e.byteLength;n++)r+=String.fromCharCode(t.getUint8(n));var n=r;let i="";for(let e=0;e<n.length;e+=3){let t=[void 0,void 0,void 0,void 0];t[0]=n.charCodeAt(e)>>2,t[1]=(3&n.charCodeAt(e))<<4,n.length>e+1&&(t[1]|=n.charCodeAt(e+1)>>4,t[2]=(15&n.charCodeAt(e+1))<<2),n.length>e+2&&(t[2]|=n.charCodeAt(e+2)>>6,t[3]=63&n.charCodeAt(e+2));for(let e=0;e<t.length;e++)void 0===t[e]?i+="=":i+=ez[t[e]]}return i}function eh(e){let t=function(e){e.length%4==0&&(e=e.replace(/==?$/,""));let t="",r=0,n=0;for(let i=0;i<e.length;i++)r<<=6,r|=ez.indexOf(e[i]),24===(n+=6)&&(t+=String.fromCharCode((0xff0000&r)>>16),t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r),r=n=0);return 12===n?(r>>=4,t+=String.fromCharCode(r)):18===n&&(r>>=2,t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r)),t}(e),r=new ArrayBuffer(t.length),n=new DataView(r);for(let e=0;e<r.byteLength;e++)n.setUint8(e,t.charCodeAt(e));return r}let ez="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function ey(e){let t=typeof e;return"string"===t?em(e):e instanceof String?em(e.toString()):void 0===e?"-1":0===e&&1/e<0?"-6":"bigint"===t?`["BigInt","${e}"]`:String(e)}let eS="scopes",ev=e=>null!==e&&"team"===eA(e),eE=()=>{let e=(0,l.useRouter)(),{user:c,setUser:m,expectUser:f}=(0,r.useUser)(),{scopes:g,isScopesReady:b,refreshScopes:h}=(0,i.useScopes)(),z=!!(b&&(!f||c)),{data:y,mutate:v,isLoading:E}=(0,t.default)(z?"activeScope":null,async()=>{let t=g?.find(o.isUserScope)??null,r=new URLSearchParams(window.location.search).get("scope");if(r){e.replace(window.location.pathname);let t=g?.find(e=>(0,o.isUserScope)(e)?e.username===r:e.slug===r&&(0,s.teamMemberHasV0Access)({membership:e.membership}));if(t){let e=eC(t),{user:r}=await ew(e);return m(r),t}}let n=c?.scope;if(!n){if(c?.limited){let e=g?.find(e=>!(0,o.isUserScope)(e)&&!e.limited&&(0,s.teamMemberHasV0Access)({membership:e.membership}))??null;if(e){let t=eC(e),{user:r}=await ew(t);m(r)}return e}if(!t&&g?.[0]&&u.PERSONAL_OPT_OUT_TEAM_IDS.includes(g[0].id)&&!c?.isVercelian){let t=eC(g[0]),{user:r}=await ew(t);return m(r),e.refresh(),g[0]}return t}let[i,a]=n.split(":");if("team"===i){let t=g?.find(e=>"slug"in e&&e.slug===a&&(0,s.teamMemberHasV0Access)({membership:e.membership}))??null;if((0,d.isScopeLimitedOnlyByMfa)(t))return(0,d.redirectToTwoFactorRequired)({slug:a,push:e.push}),null;if(t?.limited&&!(0,o.isUserScope)(t)){let{user:e}=await ew(a);m(e)}return t}return t},{revalidateIfStale:!1}),w=(0,n.useCallback)(async(t,{currentChatId:r,currentProjectId:n}={})=>{let i="slug"in t?t.slug:void 0,o=eC(t),{user:l,redirectingToHome:s}=await ew(o,{currentChatId:r,currentProjectId:n});m(l),i?(0,a.setRewrittenParam)("scope",i):(0,a.removeRewrittenParam)("scope"),s||e.refresh(),v(t,{optimisticData:t,revalidate:!1})},[v,e,m]),C=(0,n.useMemo)(()=>b&&c&&!E?y??null:null,[b,c,y,E]);(0,n.useEffect)(()=>{if(g&&C&&c){let e=localStorage.getItem(eS);try{let t=e?JSON.parse(e):[],r=new Set(t.filter(e=>"slug"in e).map(e=>e.id)),n=g.filter(e=>"slug"in e&&!r.has(e.id)&&e.id!==C.id&&!0===S(e,c));n.length>0&&e&&(0,p.openDialog)({type:"joinedNewTeams",data:{teams:n}})}catch(e){console.error(e)}localStorage.setItem(eS,JSON.stringify(g))}},[g,C,c]);let A=(0,n.useMemo)(()=>{var e;return((e=C)?(0,o.isUserScope)(e)?e.username:e.slug:null)??void 0},[C]),R=(0,n.useMemo)(()=>"team"===eA(C),[C]),U=z&&void 0!==y,O=ev(C)?C.membership.teamPermissions?.find(e=>L.includes(e)):null,I=(!O||N.includes(O))&&!c?.isImpersonation,j=(!O||"V0Builder"===O)&&!c?.isImpersonation;return{activeScope:C,activeScopeSlug:A,isActiveScopeReady:U,isTeam:R,setActiveScope:w,scopes:g,user:c,refreshScopes:h,hasWritePermission:I,hasVercelWritePermission:j,isNewV0Rbac:!!O}};async function ew(e,{currentChatId:t,currentProjectId:r}={}){let n=t?`&currentChatId=${encodeURIComponent(t)}`:"",i=r?`&currentProjectId=${encodeURIComponent(r)}`:"",a=await fetch(`/chat/api/team/change-scope?scope=${encodeURIComponent(e)}${n}${i}`,{method:"POST"});if(403===a.status){let e=await a.json();e.redirect?window.location.href=e.redirect:c.toast.error("You must be a team owner to upgrade your team.")}if(!a.ok)throw Error("Failed to update team slug cookie");let o=await a.json();if(!o.success)throw Error("Failed to update team slug cookie");return o.redirect&&(window.location.href=o.redirect),{user:o.user,redirectingToHome:!!o.redirect}}function eC(e){return(0,o.isUserScope)(e)?`user:${e.username}`:`team:${e.slug}`}function eA(e){return e?(0,o.isUserScope)(e)?"user":"team":null}function eR(){let e=eE(),{cachedData:t}=function({cacheKey:e,userId:t,currentData:r,serialize:i=function(e,t){let r=[],n=new Map,i=[];if(t)for(let e of Object.getOwnPropertyNames(t))i.push({key:e,fn:t[e]});let a=[],o=0,l=function e(t){if("function"==typeof t)throw new eu("Cannot stringify a function",a);if(n.has(t))return n.get(t);if(void 0===t)return -1;if(Number.isNaN(t))return -3;if(t===1/0)return -4;if(t===-1/0)return -5;if(0===t&&1/t<0)return -6;let l=o++;for(let{key:a,fn:o}of(n.set(t,l),i)){let n=o(t);if(n)return r[l]=`["${a}",${e(n)}]`,l}let s="";if(ed(t))s=ey(t);else{let r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Number":case"String":case"Boolean":s=`["Object",${ey(t)}]`;break;case"BigInt":s=`["BigInt",${t}]`;break;case"Date":let n=!isNaN(t.getDate());s=`["Date","${n?t.toISOString():""}"]`;break;case"RegExp":let{source:i,flags:o}=t;s=o?`["RegExp",${em(i)},"${o}"]`:`["RegExp",${em(i)}]`;break;case"Array":s="[";for(let r=0;r<t.length;r+=1)r>0&&(s+=","),r in t?(a.push(`[${r}]`),s+=e(t[r]),a.pop()):s+=-2;s+="]";break;case"Set":for(let r of(s='["Set"',t))s+=`,${e(r)}`;s+="]";break;case"Map":for(let[r,n]of(s='["Map"',t))a.push(`.get(${ed(r)?ey(r):"..."})`),s+=`,${e(r)},${e(n)}`,a.pop();s+="]";break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":s='["'+r+'","'+eb(t.buffer)+'"]';break;case"ArrayBuffer":{let e=eb(t);s=`["ArrayBuffer","${e}"]`;break}default:let l;if((l=Object.getPrototypeOf(t))!==Object.prototype&&null!==l&&Object.getOwnPropertyNames(l).sort().join("\0")!==ep)throw new eu("Cannot stringify arbitrary non-POJOs",a);if(Object.getOwnPropertySymbols(t).filter(e=>Object.getOwnPropertyDescriptor(t,e).enumerable).length>0)throw new eu("Cannot stringify POJOs with symbolic keys",a);if(null===Object.getPrototypeOf(t)){for(let r in s='["null"',t)a.push(eg(r)),s+=`,${em(r)},${e(t[r])}`,a.pop();s+="]"}else{s="{";let r=!1;for(let n in t)r&&(s+=","),r=!0,a.push(eg(n)),s+=`${em(n)}:${e(t[n])}`,a.pop();s+="}"}}}return r[l]=s,l}(e);return l<0?`${l}`:`[${r.join(",")}]`},deserialize:a=function(e,t){var r=JSON.parse(e),n=t;if("number"==typeof r)return a(r,!0);if(!Array.isArray(r)||0===r.length)throw Error("Invalid input");let i=Array(r.length);function a(e,t=!1){if(-1===e)return;if(-3===e)return NaN;if(-4===e)return 1/0;if(-5===e)return-1/0;if(-6===e)return -0;if(t)throw Error("Invalid input");if(e in i)return i[e];let o=r[e];if(o&&"object"==typeof o)if(Array.isArray(o))if("string"==typeof o[0]){let t=o[0],r=n?.[t];if(r)return i[e]=r(a(o[1]));switch(t){case"Date":i[e]=new Date(o[1]);break;case"Set":let l=new Set;i[e]=l;for(let e=1;e<o.length;e+=1)l.add(a(o[e]));break;case"Map":let s=new Map;i[e]=s;for(let e=1;e<o.length;e+=2)s.set(a(o[e]),a(o[e+1]));break;case"RegExp":i[e]=new RegExp(o[1],o[2]);break;case"Object":i[e]=Object(o[1]);break;case"BigInt":i[e]=BigInt(o[1]);break;case"null":let c=Object.create(null);i[e]=c;for(let e=1;e<o.length;e+=2)c[o[e]]=a(o[e+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{let r=new globalThis[t](eh(o[1]));i[e]=r;break}case"ArrayBuffer":{let t=eh(o[1]);i[e]=t;break}default:throw Error(`Unknown type ${t}`)}}else{let t=Array(o.length);i[e]=t;for(let e=0;e<o.length;e+=1){let r=o[e];-2!==r&&(t[e]=a(r))}}else{let t={};for(let r in i[e]=t,o){let e=o[r];t[r]=a(e)}}else i[e]=o;return i[e]}return a(0)},ttl:o}){let l=t?`${e}-${t}`:null,{data:s,mutate:c,isLoading:u}=ec(l?`cached-${e}-${t}`:null,()=>{if(!l)return null;try{let e=localStorage.getItem(l);if(!e)return null;let t=a(e);if(o&&t.timestamp&&Date.now()-t.timestamp>o)return localStorage.removeItem(l),null;return void 0!==t.data?t.data:t}catch(r){let e=r instanceof SyntaxError||r?.name==="DevalueError",t=r instanceof DOMException&&"QuotaExceededError"===r.name;if(e){console.warn(`[useLocalStorageCache] Parse error for ${l}, removing corrupted cache:`,r);try{localStorage.removeItem(l)}catch(e){console.error(`Failed to remove corrupted cache for ${l}:`,e)}}else if(t)console.warn(`[useLocalStorageCache] Storage quota exceeded for ${l}:`,r);else{console.warn(`[useLocalStorageCache] Unexpected error accessing cache for ${l}:`,r);try{localStorage.removeItem(l)}catch(e){}}return null}},{keepPreviousData:!0});return(0,n.useEffect)(()=>{if(r&&l)try{let e={data:r,timestamp:Date.now()};localStorage.setItem(l,i(e)),c(r,{revalidate:!1})}catch(r){let e=r instanceof DOMException&&"QuotaExceededError"===r.name,t=r?.name==="DevalueError";e?console.warn(`[useLocalStorageCache] Storage quota exceeded, cannot cache data for ${l}:`,r):t?console.warn(`[useLocalStorageCache] Serialization failed for ${l}:`,r):console.warn(`[useLocalStorageCache] Failed to cache data for ${l}:`,r)}},[r,l,i,c]),{cachedData:s,updateCache:e=>{if(e&&l)try{let t={data:e,timestamp:Date.now()};localStorage.setItem(l,i(t))}catch(r){let e=r instanceof DOMException&&"QuotaExceededError"===r.name,t=r?.name==="DevalueError";e?console.warn(`[useLocalStorageCache] Storage quota exceeded, cannot update cache for ${l}:`,r):t?console.warn(`[useLocalStorageCache] Serialization failed during manual update for ${l}:`,r):console.warn(`[useLocalStorageCache] Failed to manually update cache for ${l}:`,r)}return c(e,{revalidate:!1})},clearCache:()=>(l&&localStorage.removeItem(l),c(null,{revalidate:!1})),isLoading:u,storageKey:l}}({cacheKey:"scopes",userId:e.user?.id,currentData:e.scopes}),r=(0,n.useMemo)(()=>{if(e.activeScope||!e.user)return e.activeScope;if(t&&t.length>0&&!e.isActiveScopeReady){let r=t.find(e=>(0,o.isUserScope)(e)),n=e.user.scope;if(n){let[e,r]=n.split(":");if("team"===e){let e=t.find(e=>"slug"in e&&e.slug===r);if(e)return e}}return r||null}return e.activeScope},[e.activeScope,e.user,e.isActiveScopeReady,t]),i=(0,n.useMemo)(()=>e.isActiveScopeReady||!!t?.length&&e.user&&null!==r,[e.isActiveScopeReady,t,e.user,r]);return{...e,activeScope:r,isActiveScopeReady:i,scopes:e.scopes||t||[]}}e.s(["getScopeCookieKey",()=>eC,"scopeIsTeam",0,ev,"updateTeamSlugCookie",()=>ew,"useActiveScope",0,eE,"useActiveScopeLocalStorage",()=>eR],667660)}]);